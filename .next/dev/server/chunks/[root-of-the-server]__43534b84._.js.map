{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER3/Desktop/oscorm-fe/app/api/images/%5B...path%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\n\r\nconst API_URL = 'https://competent-shirley.72-61-78-56.plesk.page';\r\n\r\nexport async function GET(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ path: string[] }> }\r\n) {\r\n    try {\r\n        const { path } = await params;\r\n        const imagePath = path.join('/');\r\n        \r\n        // Construct the full URL to the external image\r\n        let imageUrl: string;\r\n        if (imagePath.startsWith('http://') || imagePath.startsWith('https://')) {\r\n            // If it's already a full URL, decode it\r\n            imageUrl = decodeURIComponent(imagePath);\r\n        } else if (imagePath.startsWith('/uploads/') || imagePath.startsWith('/storage/') || imagePath.startsWith('/images/')) {\r\n            // If it's a relative path, prepend API URL\r\n            imageUrl = `${API_URL}${imagePath}`;\r\n        } else {\r\n            // Default: prepend API URL with slash\r\n            imageUrl = `${API_URL}/${imagePath}`;\r\n        }\r\n        \r\n        // Fetch the image from the external API\r\n        const response = await fetch(imageUrl, {\r\n            method: 'GET',\r\n            headers: {\r\n                'Accept': 'image/*',\r\n            },\r\n            next: { revalidate: 3600 }, // Cache for 1 hour\r\n        });\r\n        \r\n        if (!response.ok) {\r\n            return new NextResponse('Image not found', { status: 404 });\r\n        }\r\n        \r\n        // Get the image data\r\n        const imageBuffer = await response.arrayBuffer();\r\n        const contentType = response.headers.get('content-type') || 'image/jpeg';\r\n        \r\n        // Return the image with proper headers\r\n        return new NextResponse(imageBuffer, {\r\n            headers: {\r\n                'Content-Type': contentType,\r\n                'Cache-Control': 'public, max-age=3600, s-maxage=3600',\r\n            },\r\n        });\r\n    } catch (error: any) {\r\n        console.error('Error in image proxy API route:', error);\r\n        return new NextResponse('Failed to fetch image', { status: 500 });\r\n    }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,UAAU;AAET,eAAe,IAClB,OAAoB,EACpB,EAAE,MAAM,EAA2C;IAEnD,IAAI;QACA,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM;QACvB,MAAM,YAAY,KAAK,IAAI,CAAC;QAE5B,+CAA+C;QAC/C,IAAI;QACJ,IAAI,UAAU,UAAU,CAAC,cAAc,UAAU,UAAU,CAAC,aAAa;YACrE,wCAAwC;YACxC,WAAW,mBAAmB;QAClC,OAAO,IAAI,UAAU,UAAU,CAAC,gBAAgB,UAAU,UAAU,CAAC,gBAAgB,UAAU,UAAU,CAAC,aAAa;YACnH,2CAA2C;YAC3C,WAAW,GAAG,UAAU,WAAW;QACvC,OAAO;YACH,sCAAsC;YACtC,WAAW,GAAG,QAAQ,CAAC,EAAE,WAAW;QACxC;QAEA,wCAAwC;QACxC,MAAM,WAAW,MAAM,MAAM,UAAU;YACnC,QAAQ;YACR,SAAS;gBACL,UAAU;YACd;YACA,MAAM;gBAAE,YAAY;YAAK;QAC7B;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,OAAO,IAAI,gJAAY,CAAC,mBAAmB;gBAAE,QAAQ;YAAI;QAC7D;QAEA,qBAAqB;QACrB,MAAM,cAAc,MAAM,SAAS,WAAW;QAC9C,MAAM,cAAc,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;QAE5D,uCAAuC;QACvC,OAAO,IAAI,gJAAY,CAAC,aAAa;YACjC,SAAS;gBACL,gBAAgB;gBAChB,iBAAiB;YACrB;QACJ;IACJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,IAAI,gJAAY,CAAC,yBAAyB;YAAE,QAAQ;QAAI;IACnE;AACJ"}}]
}